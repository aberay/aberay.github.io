<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒ∞zmit Hava</title>
<style>
body {
  margin: 0;
  background: #1d1d1d;
  color: #f3f3f3;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  font-size: 13px;
  text-transform: lowercase;
}
#bar {
  height: 55px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 10px;
  box-sizing: border-box;
}
.date, .next-date {
  display: flex;
  align-items: flex-end;
  gap: 3px;
  white-space: nowrap;
}
.date span.small,
.next-date span.small {
  font-size: 10px;
  opacity: 0.8;
}
.center {
  display: flex;
  align-items: center;
  gap: 5px;
}
.icon {
  font-size: 20px;
  line-height: 1;
}
.temp {
  font-weight: 500;
  color: #f3f3f3;
}
.temp-min {
  font-size: 12px;
  opacity: 0.6;
}
.temp-min.red { color: #ff4c4c; opacity: 1; }
.temp-min.green { color: #4fc03e; opacity: 1; }
.next-date.green { color: #4fc03e; }
.date.red span.small { color: #ff4c4c; }
.date.green span.small { color: #4fc03e; }
</style>
</head>
<body>
<div id="bar">
  <div class="date" id="date-left"><span>y√ºkleniyor</span></div>
  <div class="center">
    <span class="icon" id="icon">‚òÄÔ∏è</span>
    <span class="temp" id="temp-now">--¬∞</span>
    <span class="temp-min" id="temp-min">--¬∞</span>
  </div>
  <div class="next-date" id="date-right">--</div>
</div>

<script>
const LAT = 40.7667, LON = 29.9167;

const iconMap = {
  0:"‚òÄÔ∏è",1:"üå§Ô∏è",2:"‚õÖ",3:"‚òÅÔ∏è",45:"üå´Ô∏è",48:"üå´Ô∏è",
  51:"üå¶Ô∏è",53:"üåßÔ∏è",55:"üåßÔ∏è",61:"üåßÔ∏è",63:"üåßÔ∏è",
  65:"üåßÔ∏è",71:"üå®Ô∏è",73:"üå®Ô∏è",75:"üå®Ô∏è",80:"üå¶Ô∏è",
  81:"üåßÔ∏è",82:"üåßÔ∏è",95:"‚õàÔ∏è",96:"‚õàÔ∏è",99:"‚õàÔ∏è"
};

const rainCodes = [51,53,55,61,63,65,71,73,75,80,81,82,95,96,99];

(async()=>{
  const url=`https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&hourly=weathercode&daily=temperature_2m_min,temperature_2m_max,weathercode&timezone=auto`;
  const r=await fetch(url);const d=await r.json();

  const now=d.current_weather;
  const daily=d.daily;
  const hourly=d.hourly;

  const today=0, tomorrow=1;
  const nowTemp=Math.round(now.temperature);
  const minTemp=Math.round(daily.temperature_2m_min[today]);
  const codeNow=now.weathercode;
  const codeToday=daily.weathercode[today];
  const codeTomorrow=daily.weathercode[tomorrow];
  
  // Tarihler
  const t1=new Date(daily.time[today]);
  const t2=new Date(daily.time[tomorrow]);
  const days=["pazar","pazartesi","salƒ±","√ßar≈üamba","per≈üembe","cuma","cumartesi"];
  const months=["ocak","≈üubat","mart","nisan","mayƒ±s","haziran","temmuz","aƒüustos","eyl√ºl","ekim","kasƒ±m","aralƒ±k"];

  const left=document.getElementById("date-left");
  const right=document.getElementById("date-right");

  left.innerHTML=`${days[t1.getDay()]}, <span class="small">${t1.getDate()}.</span>`;
  right.innerHTML=`<span class="small">${t2.getDate()} ${months[t2.getMonth()]}.</span>`;

  // renk kuralƒ±: bug√ºn ayƒ±n son g√ºn√º ise kƒ±rmƒ±zƒ±
  const nextMonth = new Date(t1);
  nextMonth.setMonth(t1.getMonth()+1,0); // ayƒ±n son g√ºn√º
  if(t1.getDate()===nextMonth.getDate()) left.classList.add("red");
  // bug√ºn ayƒ±n ilk g√ºn√º ise ye≈üil
  if(t1.getDate()===1) left.classList.add("green");
  // ertesi g√ºn ayƒ±n ilk g√ºn√º ise next-date ye≈üil
  if(t2.getDate()===1) right.classList.add("green");

  // sƒ±caklƒ±klar
  document.getElementById("temp-now").textContent=`${nowTemp}¬∞`;
  const minEl=document.getElementById("temp-min");
  minEl.textContent=`${minTemp}¬∞`;

  // hava durumu ikonu
  document.getElementById("icon").textContent=iconMap[codeNow]||"‚ùì";

  // d√º≈ü√ºk sƒ±caklƒ±k rengi kuralƒ±:
  // sabah yaƒümurlu -> ak≈üam yaƒümur yok => ye≈üil
  // bug√ºn yaƒümurlu deƒüil -> ak≈üam yaƒümur ba≈ülƒ±yorsa => kƒ±rmƒ±zƒ±
  // bug√ºn de ak≈üam da yaƒümurluysa -> gri (default)
  const eveningCode = hourly.weathercode.slice(18,24).find(c=>c); // ak≈üam tahmini
  const nowIsRain = rainCodes.includes(codeNow) || rainCodes.includes(codeToday);
  const eveningIsRain = rainCodes.includes(eveningCode);
  if(nowIsRain && !eveningIsRain) minEl.classList.add("green");
  else if(!nowIsRain && eveningIsRain) minEl.classList.add("red");

})();
</script>
</body>
</html>
